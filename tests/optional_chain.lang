// Test optional chaining (?.)

// Define a record type
type Person = { name: String, age: Int }

// Test with Option
person1: Option<Person> = Some({ name: "Alice", age: 30 })
person2: Option<Person> = Zero

// ?. on Some returns Some(field)
result1 = person1?.name
print(result1)  // Some("Alice")

result2 = person1?.age
print(result2)  // Some(30)

// ?. on Zero returns Zero
result3 = person2?.name
print(result3)  // Zero

result4 = person2?.age
print(result4)  // Zero

// Chaining with ??
name1 = person1?.name ?? "Unknown"
print(name1)  // Alice

name2 = person2?.name ?? "Unknown"
print(name2)  // Unknown

// Test with Result
type User = { id: Int, email: String }

user1: Result<String, User> = Ok({ id: 1, email: "alice@example.com" })
user2: Result<String, User> = Fail("User not found")

// ?. on Ok returns Ok(field)
email1 = user1?.email
print(email1)  // Ok("alice@example.com")

// ?. on Fail returns Fail(error)
email2 = user2?.email
print(email2)  // Fail("User not found")

// Chaining with ??
email3 = user1?.email ?? "no-email"
print(email3)  // alice@example.com

email4 = user2?.email ?? "no-email"
print(email4)  // no-email

// Nested chaining
type Address = { city: String, zip: Int }
type Employee = { name: String, address: Address }

emp1: Option<Employee> = Some({ name: "Ivan", address: { city: "Moscow", zip: 101 } })
emp2: Option<Employee> = Zero

// Double chain
print(emp1?.address?.city)  // Some("Moscow")
print(emp2?.address?.city)  // Zero

// Triple with ??
city1 = emp1?.address?.city ?? "Unknown"
print(city1)  // Moscow

city2 = emp2?.address?.city ?? "Unknown"  
print(city2)  // Unknown

print("Optional chaining test passed!")

